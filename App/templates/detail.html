{% extends "base.html" %} {% block csses %}
<style>
    * {
        padding: 0;
        margin: 0;
    }

    #image {
        display: -webkit-flex;
        display: flex;
        flex-wrap: nowrap;
        justify-content: flex-start;
    }

    .image_menu {
        order: 0;
        flex: none;
        width: 200px;
        height: auto;
    }

    .image_middle {
        width: 5px;
        height: auto;
        background-color: black;
        order: 1;
        flex: none;
    }

    .image_right {
        order: 2;
        flex: 1 1 auto;
    }

    .image_right>div {
        width: 100%;
        overflow: auto;
    }
</style>
{% endblock %} {% block page_content %}

<div id="image">

    <div class="image_menu" v-if="isshowmenu">
        <select v-model="imgtype">
            <option value="adaptw">适应宽</option>
            <option value="adapt">合适</option>
            <option value="repeat">平铺</option>
            <option value="orign">原图</option>
            <option value="adapth">适应高</option>
        </select>
        <div></div>
    </div>
    <div class="image_middle" v-on:click="setshowleft()">
    </div>
    <div class="image_right">
        <div id="image_box" align="center" v-bind:style="rightcontentcss">
            <span v-bind:style="rightblackcss"></span>
            <img style="vertical-align:middle" v-bind:style="rightimgcss" v-bind:src="currentimage.url" />
        </div>
    </div>
</div>
{% endblock %} {% block scripts %}
<script type="text/javascript" language="javascript" src="/App/static/jquery.mousewheel.js" charset="utf-8"></script>

<script>
    var image = new Vue({
        el: '#image',
        data: {
            items: [],
            currentimage: '',
            isshowmenu: true,
            imgtype: "adaptw",
            windowheight: 0,
            imgheight:0,
            imgwidth:0,
        },
        computed: {
            rightcontentcss: function () {
                var obj = { 'box-sizing':'border-box', height: this.windowheight-10 + 'px' };
                switch (this.imgtype) {
                    case "adaptw":
                        obj.overflow = "auto";
                        break;
                };
                return obj;
            },
            rightblackcss: function () {
                var obj = { 'line-height': this.windowheight-10 + 'px' };
                return obj;
            },
            rightimgcss: function () {
                var obj = {};
                switch (this.imgtype) {
                    case "repeat":
                        obj = { width: "100%", height: "100%" };
                        break;
                    case "adaptw":
                        obj = { width: "100%"};
                        break;
                    case "adapth":
                        obj = { height: "100%" };
                        break;
                    case "adapt":
                        var box=$("#image_box");
                        if(this.imgwidth!=0&&this.imgheight/this.imgwidth>box.height()/box.width()){
                            obj = { height: "100%" };
                        }else{
                            obj = { width: "100%"};
                        }
                        break;
                    case "orign":
                        break;
                };
                return obj;
            },
        },
        methods: {
            setshowleft() {
                this.isshowmenu = !this.isshowmenu;
            },
            setheight() {
                this.windowheight = $(window).height()
            },   
            get() {
                self = this;
                API.image.getsbysection(
                    function (data) {
                        if(data&&data.length>0){
                            self.currentimage = data[0];                    
                            self.$nextTick(function(){
                                var img=$("#image_box img")[0];
                                if(img){
                                    self.imgheight=img.naturalHeight;
                                    self.imgwidth=img.naturalWidth;
                                }
                            })
                        }
                    },
                    this.index,
                    parseInt(this.index)+1,
                    { params: { tag: this.tag, score: this.score, sort:this.sort }});
            },
            getother(isup) {
                scrollheight = parseFloat($('#image_box').scrollTop());
                // config.log(scrollheight);
                // config.log($('#image_box').height());
                // config.log($('#image_box img').height());
                if (isup && scrollheight < 3) {
                    this.index = parseInt(this.index) - 1;
                    if(this.index>-1)
                        this.get();
                }
                else if (!isup && ($('#image_box').height() + scrollheight > $('#image_box img').height() - 3)) {                    
                    this.index = parseInt(this.index) + 1;
                    this.get();
                    $('#image_box').scrollTop(0);
                }
            },
        },
        mounted: function () {
            this.index = Vue.GetUrlParam("index");
            this.tag = Vue.GetUrlParam("tag");
            this.score = Vue.GetUrlParam("score");
            this.sort = Vue.GetUrlParam("sort");
            this.get();
            this.setheight();
            self = this;
            $(window).resize(function () {
                self.setheight();
            });
            $('#image_box')
                .mousewheel(function (event, delta) {
                    var isup = delta > 0;
                    config.log(delta);
                    self.getother(isup);
                })
        },
    })
</script> {% endblock %}